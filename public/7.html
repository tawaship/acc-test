<<<<<<< HEAD
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no, minimal-ui">
	<title>Device Orientation</title>
<script src="pixi.5.3.2.min.js"></script>
<script src="Pixim.min.js"></script>
</head>
<body style="margin: 0; background: #000; overflow: hidden; color: #000;">
	<div style="position: absolute; z-index: 1; font-size: 2vw;">
		var 10
		<div id="do">-</div>
		<div id="al">-</div>
		<div id="be">-</div>
		<div id="ga">-</div>
	</div>
	<script>
		const d = innerHeight / innerWidth;
		var w = 800;
		var h = 800 * d;
		
		var Content = Pixim.Content.create();
		Content.setConfig({
			width: w,
			height: h
		});
		
		document.getElementById('do').textContent = String(Boolean(window.DeviceOrientationEvent))
		
		Content.defineLibraries({
			root: class Root extends Pixim.Container {
				constructor($) {
					super();
					
					//$.vars.emitter.on("update", e => {
						
					//});
					
					/*
					const co = this.addChild(new PIXI.Container())
					const a = co.addChild(new PIXI.Graphics())
					.beginFill(0x0000FF, 1)
					.drawRect(-500, 50, 1000, 150)
					
					const co2 = co.addChild(new PIXI.Container())
					
					
					const b = co2.addChild(new PIXI.Graphics())
					.lineStyle(1, 0)
					.drawRect(0, 0, 100, 200)
					
					const b2 = co2.addChild(new PIXI.Graphics())
					.lineStyle(2, 0xFF0000)
					.drawRect(0, 50, 100, 0)
					
					const c = co2.addChild(new PIXI.Graphics())
					.beginFill(0, 0.1)
					.drawRect(0, 0, 100, 200)
					
					//a.mask = c
					
					co.x = co.y = 300;
					co.pivot.set(0, 200)
					*/
					
					//this.x = 100
					
					let defValue = Math.random() * 0.5 + 0.3;
					
					var defY = $.height * (1 - defValue);
					let val = defValue
					const g = this.addChild(new PIXI.Container());
					
					const container = this.addChild(new PIXI.Container());
					
					const liquid = container.addChild(new PIXI.Graphics())
					.beginFill(0x0000FF, 1)
					.drawRect(-$.width * 2, 0, $.width * 5, $.height);
					
					liquid.addChild(new PIXI.Graphics())
					.beginFill(0xFF0000, 1)
					.drawCircle(0, 0, 10);
					//liquid.pivot.x = $.width / 2;
					//liquid.x = $.width * defValue;
					liquid.y = $.height * (1 - defValue);
					
					const l = this.addChild(new PIXI.Graphics())
					.lineStyle(3, 0xFF0000)
					.moveTo(0, 0)
					.lineTo($.width, 0);
					
					l.y = $.height * (1 - defValue);
					
					const l2 = this.addChild(new PIXI.Graphics())
					.lineStyle(3, 0x00FF00)
					.moveTo(0, 0)
					.lineTo(0, $.height);
					
					l2.x = $.width * (1 - defValue);
					
					const l3 = this.addChild(new PIXI.Graphics())
					.lineStyle(3, 0xFF0000)
					.moveTo(0, 0)
					.lineTo(0, $.height);
					
					l3.x = $.width * defValue;
					
					liquid.y = $.height * (1 - defValue);
					
					//const defY = $.height * (1 - defValue);
					
					//0.4h * w = h * 
					//const rt = $.width / 
					
					var f = 0;
					var ff = 5;
					var tf = 25;
					
					const aa = ra => {
					
						if (r === 90) {
							r = 91;
						} else if (r === 270) {
							r = 269
						}
						
						const rad = r * Math.PI / 180;
						
						//console.log(Math.tan(r))
						
						
						
						var dy;
						if (Math.cos(rad) < 0) {
							dy = 1;
						} else {
						
							var t = Math.tan(rad);
							
							if (t < 0) {
								dy = 1;
							} else {
								dy = t * liquid.x - liquid.y;
							}
						}
						
						if (dy > 0) {
							if (++f > ff) {
								defValue -= 0.0005 * f;
								if (f > tf) {
									f = 0;
								}
							}
							
						} else {
							f = 0;
						}
						
						//console.log( Math.tan(rad))
						//liquid.x = r / 90 * $.width * defValue;
						//liquid.y = (90 - r) / 90 * $.height * (1 - defValue);
						//liquid.x = (1 - Math.cos(rad)) * $.width * defValue;
						
						//liquid.x = Math.sin(rad) * $.width * (0.5 - defValue) + $.width * defValue;
						//liquid.y = $.width / 2 * Math.tan(rad)+$.width * (1 - defValue);
						
						//liquid.x = Math.sin(rad) * $.width * defValue;
						//*
						//liquid.x = Math.sin(rad) * $.width * (1-defValue) + $.width * (defValue);
						//liquid.y = Math.cos(rad) * $.height * (1 - defValue);
						
						
						//var aaa = this.addChild(new PIXI.Graphics())
						//.beginFill(0x00FF00, 1)
						//.drawCircle(0, 0, 5);
						
						//aaa.x = liquid.x
						///aaa.y = liquid.y
						//*/
						//var y = 0
						//if (r > 0) {
						//	y = Math.tan(rad) * $.width * defValue;
						//}
						
						//*
						var c = (Math.cos(rad))
						liquid.y = $.height * (1 - defValue) - (1- c) * $.height *  (0.5 - defValue);
						
						var s = (Math.sin(rad))
						liquid.x = $.width * defValue + (1-s) * $.width * (0.5 - defValue);
						//liquid.y = Math.cos(rad) * $.height * (1 - defValue);
						
						
						//*/
						/*
						liquid.y = defY;
						
						liquid.x = $.width / $.height * defY
						*/
						liquid.rotation = rad;
					}
					//liquid.y -= 100
					
					let r = 0;
					var d = 95;
					
					var _alpha = 0;
					var _beta = 0;
					var _gamma = 0;
					
					$.vars.emitter.on('deviceorientation', e => {
						_alpha = e.alpha;
						_beta = e.beta;
						_gamma = e.gamma;
					});
					
					//const thresholdGamma = 45;
					
					/*
					const ra = this.addChild(new PIXI.Text());
					ra.x = 10;
					ra.y = 10;
					
					const be = this.addChild(new PIXI.Text());
					be.x = 10;
					be.y = 50;
					
					const ta = this.addChild(new PIXI.Text());
					ta.x = 10;
					ta.y = 90;
					
					*/
					this.task.on('loop', e => {
						//let beta = (_beta < -90 ? 180 : (_beta < 0 ? 0 : _beta)) - 90;
						
						// ’[––‚ª’n•½–ÊˆÈ‰º‚ÉŒX‚¢‚½ê‡‚ÍA’n•½–Ê‚æ‚è1‹ãŒX‚«‚É•â³‚·‚é (‚ ‚Æ‚Åtan‚ğg‚¤‚Ì‚ÅA}90‹‚É‚Í‚µ‚È‚¢)
						let beta = (_beta + 180) % 359;
						beta = (beta <= 90 ? 359 : (beta <= 181 ? 181 : beta)) - 270;
						
						//be.text = beta;
						
						// ’[––y²‚ª’n•½–ÊˆÈ‰º‚ÉŒX‚¢‚½ê‡‚ÍA’n•½–Ê‚æ‚è1‹ãŒX‚«‚É•â³‚·‚é (‚ ‚Æ‚Åtan‚ğg‚¤‚Ì‚ÅA}90‹‚É‚Í‚µ‚È‚¢)
						const rad = beta * Math.PI / 180 * Math.sin(_gamma * Math.PI / 180);
						//ra.text = rad;
						
						const _x = rad < 0 ? -($.width - liquid.x) : liquid.x;
						//ta.text = Math.tan(rad) * _x;
						
						if (Math.tan(rad) * _x - liquid.y > 0) {
							if (++f > ff) {
								defValue -= 0.0002 * f;
								if (f > tf) {
									f = 0;
								}
							}
						} else {
							f = 0;
						}
						
						//console.log( Math.tan(rad))
						//liquid.x = r / 90 * $.width * defValue;
						//liquid.y = (90 - r) / 90 * $.height * (1 - defValue);
						//liquid.x = (1 - Math.cos(rad)) * $.width * defValue;
						
						//liquid.x = Math.sin(rad) * $.width * (0.5 - defValue) + $.width * defValue;
						//liquid.y = $.width / 2 * Math.tan(rad)+$.width * (1 - defValue);
						
						//liquid.x = Math.sin(rad) * $.width * defValue;
						//*
						//liquid.x = Math.sin(rad) * $.width * (1-defValue) + $.width * (defValue);
						//liquid.y = Math.cos(rad) * $.height * (1 - defValue);
						
						
						//var aaa = this.addChild(new PIXI.Graphics())
						//.beginFill(0x00FF00, 1)
						//.drawCircle(0, 0, 5);
						
						//aaa.x = liquid.x
						///aaa.y = liquid.y
						//*/
						//var y = 0
						//if (r > 0) {
						//	y = Math.tan(rad) * $.width * defValue;
						//}
						
						//*
						var c = (Math.cos(rad));
						liquid.y = $.height * (1 - defValue) - (1- c) * $.height *  (0.5 - defValue);
						
						var s = (Math.sin(rad))
						liquid.x = $.width * defValue + (1-s) * $.width * (0.5 - defValue);
						//liquid.y = Math.cos(rad) * $.height * (1 - defValue);
						
						
						
						
						//*/
						/*
						liquid.y = defY;
						
						liquid.x = $.width / $.height * defY
						*/
						
						liquid.rotation = rad;
						
						//orbit.drawCircle(liquid.x, liquid.y, 3);
					});
					
					const orbit = this.addChild(new PIXI.Graphics())
						.beginFill(0x00FF00, 1);
				}
			}
		});
		
		const emitter = new Pixim.Emitter();
		
		const al = document.getElementById('al');
		const be = document.getElementById('be');
		const ga = document.getElementById('ga');
		
		window.addEventListener('deviceorientation', e => {
			al.textContent = e.alpha;
			be.textContent = e.beta;
			ga.textContent = e.gamma;
			
			emitter.emit('deviceorientation', e);
		});
		
		var app = new Pixim.Application({
			width: w,
			height: h,
			backgroundColor: 0xFFFFFF
		});
		
		var content = new Content();
		content.addVars({
			emitter
		});
		
		window.addEventListener('touchend', () => {
			if (!DeviceMotionEvent || !DeviceMotionEvent.requestPermission) {
				return;
			}
			
			DeviceMotionEvent.requestPermission();
		});
		
	 	app
	 		.fullScreen()
			.attachAsync(content)
			.then(() => {
				app.play();
				/*
				emitter.emit('deviceorientation', {
					alpha: 0,
					beta: 135,
					gamma: 90
				});
				*/
			});
	</script>
</body>
</html>
=======
ãƒ‡ãƒã‚¤ã‚¹ã‚’æ°´å¹³ã«å¯ã‹ã›ã¦é–²è¦§ã—ã¦ã„ã‚‹å ´åˆ
<div id="element_05_compass_h" style="margin:10px 0px 10px 100px; width:200px; height:200px; position:relative; line-height:1; background:#fcc; border:10px solid #caa; border-radius:100px;">
<div style="position:absolute; width:180px; height:180px; font-size:180px; font-weight:bold; top:0; bottom:0; left:0; right:0; margin:auto;">â†‘</div>
</div>
angle<br>
<input id="input_05_angle_h" style="margin-bottom:5px;"><br>
+(axisY)<br>
x:<input id="input_05_axis_y_x" style="width:70px;"> y:<input id="input_05_axis_y_y" style="width:70px;"> z:<input id="input_05_axis_y_z" style=" width:70px; margin-bottom:5px;"><br>
<hr>
ãƒ‡ãƒã‚¤ã‚¹ã‚’å‚ç›´ã«ç«‹ã¦ã¦é–²è¦§ã—ã¦ã„ã‚‹å ´åˆ
<div id="element_05_compass_v" style="margin:-50px 0px -30px 100px; width:200px; height:200px; position:relative; line-height:1; background:#ccf; border:10px solid #aac;">
<div style="position:absolute; width:180px; height:180px; font-size:180px; font-weight:bold; top:0; bottom:0; left:0; right:0; margin:auto;">â†‘</div>
</div>
angle<br>
<input id="input_05_angle_v" style="margin-bottom:5px;"><br>
-(axisZ)<br>
x:<input id="input_05_axis_z_x" style="width:70px;"> y:<input id="input_05_axis_z_y" style="width:70px;"> z:<input id="input_05_axis_z_z" style=" width:70px; margin-bottom:5px;"><br>

<script type="text/javascript">
// åŒ¿åé–¢æ•°å†…ã§å®Ÿè¡Œ
(function (){

	// ------------------------------------------------------------
	// å„è¦ç´ ã‚’å–å¾—
	// ------------------------------------------------------------
	var input_angle_h = document.getElementById("input_05_angle_h");
	var input_angle_v = document.getElementById("input_05_angle_v");
	var element_compass_h = document.getElementById("element_05_compass_h");
	var element_compass_v = document.getElementById("element_05_compass_v");
	var input_axis_y_x = document.getElementById("input_05_axis_y_x");
	var input_axis_y_y = document.getElementById("input_05_axis_y_y");
	var input_axis_y_z = document.getElementById("input_05_axis_y_z");
	var input_axis_z_x = document.getElementById("input_05_axis_z_x");
	var input_axis_z_y = document.getElementById("input_05_axis_z_y");
	var input_axis_z_z = document.getElementById("input_05_axis_z_z");

	// ------------------------------------------------------------
	// ãƒ‡ãƒã‚¤ã‚¹ã®å§¿å‹¢ãŒå¤‰åŒ–ã™ã‚‹ãŸã³ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
	// ------------------------------------------------------------
	window.addEventListener( "deviceorientation" , function (e){

		// ------------------------------------------------------------
		// ãƒ‡ãƒã‚¤ã‚¹ã®ç¾åœ¨ã®å„è»¸ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—ã™ã‚‹
		// ------------------------------------------------------------
		var ro = -(window.orientation || 0) * Math.PI / 180;
		var ry =  (e.gamma || 0) * Math.PI / 180;
		var rx =  (e.beta  || 0) * Math.PI / 180;
		var rz =  (e.alpha || 0) * Math.PI / 180;
		var co = Math.cos(ro);
		var so = Math.sin(ro);
		var cy = Math.cos(ry);
		var sy = Math.sin(ry);
		var cx = Math.cos(rx);
		var sx = Math.sin(rx);
		var cz = Math.cos(rz);
		var sz = Math.sin(rz);

		// ãƒ­ãƒ¼ã‚«ãƒ« x è»¸ãƒ™ã‚¯ãƒˆãƒ«
		var axisX = {
			x: co * cy * cz - co * sy * sx * sz - so * cx * sz,
			y: co * cy * sz + co * sy * sx * cz + so * cx * cz,
			z:-co * sy * cx + so * sx
		};

		// ãƒ­ãƒ¼ã‚«ãƒ« y è»¸ãƒ™ã‚¯ãƒˆãƒ«
		var axisY = {
			x:-so * cy * cz + so * sy * sx * sz - co * cx * sz,
			y:-so * cy * sz - so * sy * sx * cz + co * cx * cz,
			z: so * sy * cx + co * sx
		};

		// ãƒ­ãƒ¼ã‚«ãƒ« z è»¸ãƒ™ã‚¯ãƒˆãƒ«
		var axisZ = {
			x: sy * cz + cy * sx * sz,
			y: sy * sz - cy * sx * cz,
			z: cy * cx
		};

		// ------------------------------------------------------------
		// ãƒ‡ãƒã‚¤ã‚¹ã‚’æ°´å¹³ã«å¯ã‹ã›ã¦é–²è¦§ã—ã¦ã„ã‚‹å ´åˆ
		// ------------------------------------------------------------
		var angle = Math.atan2(-axisY.x,axisY.y) * (180.0 / Math.PI);
		if(axisZ.z < 0) angle = -angle;

		element_compass_h.style.transform = "rotate(" + (angle) + "deg)";
		input_angle_h.value = angle;
		input_axis_y_x.value = (axisY.x).toFixed(4);
		input_axis_y_y.value = (axisY.y).toFixed(4);
		input_axis_y_z.value = (axisY.z).toFixed(4);

		// ------------------------------------------------------------
		// ãƒ‡ãƒã‚¤ã‚¹ã‚’å‚ç›´ã«ç«‹ã¦ã¦é–²è¦§ã—ã¦ã„ã‚‹å ´åˆ
		// ------------------------------------------------------------
		var angle = Math.atan2(axisX.x,-axisZ.y) * (180.0 / Math.PI);

		element_compass_v.style.transform = "perspective(300px) rotateX(65deg) rotateZ(" + (angle).toFixed(10) + "deg)";
		input_angle_v.value = angle;
		input_axis_z_x.value = (-axisX.x).toFixed(4);
		input_axis_z_y.value = (-axisX.y).toFixed(4);
		input_axis_z_z.value = (-axisX.z).toFixed(4);
	});

})();
</script>
>>>>>>> af788ecf4f8a46360c4183cad6c536fb96edf840
